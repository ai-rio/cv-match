#!/usr/bin/env sh

echo "🧪 Running pre-push checks..."

# Frontend TypeScript type checking
if [ -d "frontend" ]; then
    echo "📝 Running TypeScript type checking..."
    cd frontend
    bun run type-check || {
        echo "❌ TypeScript type checking failed"
        exit 1
    }
    cd ..
fi

# Frontend ESLint check (blocking)
if [ -d "frontend" ]; then
    echo "🔍 Running ESLint..."
    cd frontend
    bun run lint || {
        echo "❌ ESLint failed - fix issues before pushing"
        exit 1
    }
    cd ..
fi

# Backend Python linting
if [ -d "backend" ]; then
    echo "🐍 Running Python linting..."
    cd backend
    uv run ruff check . || {
        echo "❌ Python linting failed - fix issues before pushing"
        exit 1
    }
    cd ..
fi

# Backend Python type checking (blocking)
if [ -d "backend" ]; then
    echo "🐍 Running Python type checking..."
    cd backend
    if [ -f "pyproject.toml" ]; then
        uv run mypy app/ --ignore-missing-imports --explicit-package-bases || {
            echo "❌ Python type checking failed - fix type errors before pushing"
            exit 1
        }
    fi
    cd ..
fi

echo "✅ All pre-push checks completed!"
echo "🚀 Pushing to remote..."
