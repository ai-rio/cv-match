#!/usr/bin/env sh

echo "ğŸ§ª Running pre-push checks..."

# Frontend TypeScript type checking
if [ -d "frontend" ]; then
    echo "ğŸ“ Running TypeScript type checking..."
    cd frontend
    bun run type-check || {
        echo "âŒ TypeScript type checking failed"
        exit 1
    }
    cd ..
fi

# Frontend ESLint check (no auto-fix on pre-push)
if [ -d "frontend" ]; then
    echo "ğŸ” Running ESLint..."
    cd frontend
    bun run lint || {
        echo "âŒ ESLint failed"
        exit 1
    }
    cd ..
fi

# Backend Python type checking
if [ -d "backend" ]; then
    echo "ğŸ Running Python type checking..."
    cd backend
    if [ -f "pyproject.toml" ]; then
        uv run mypy app/ --ignore-missing-imports --explicit-package-bases || {
            echo "âŒ Python type checking failed"
            exit 1
        }
    fi
    cd ..
fi

# Backend Python linting
if [ -d "backend" ]; then
    echo "ğŸ Running Python linting..."
    cd backend
    uv run ruff check . || {
        echo "âŒ Python linting failed"
        exit 1
    }
    cd ..
fi

# Optional: Run tests (can be commented out if too slow)
echo "âš ï¸  Skipping tests (uncomment in .husky/pre-push to enable)"
# Uncomment below to run tests before push:
# if [ -d "frontend" ]; then
#     echo "âš›ï¸  Running frontend tests..."
#     cd frontend && bun run test:coverage || exit 1
#     cd ..
# fi
# if [ -d "backend" ]; then
#     echo "ğŸ Running backend tests..."
#     cd backend && uv run pytest || exit 1
#     cd ..
# fi

echo "âœ… All pre-push checks passed!"
echo "ğŸš€ Ready to push!"
